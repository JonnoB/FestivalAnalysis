---
title: "Untitled"
author: "Jonathan Bourne"
date: "13 July 2017"
output: html_document
---


```{r}

packages<- c("tidyverse", "rvest", "tm.plugin.lexisnexis", "tidytext", "stringr", "tm", "ggfortify")

new.packages <- packages[!(packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)


lapply(packages, library, character.only = TRUE)
#used for doing operation in the corpus
PatternReplace <- content_transformer(function(x, pattern, replacement) gsub(pattern, replacement, x))

setwd("/home/jonno/FestivalAnalysis/FestivalAnalysis/Functions")
list.files() %>% sapply(.,source)



```


```{r}


FestivalData <-data_frame(Festival = c("Notting Hill", "Glastonbury", "FSTVL", "Lovebox", "Wireless", "SW4", "T in the Park", "Reading", "Bestival", "Leeds"),
           Capacity = c(1e6, 1e5, 1.5e4, 5e4, 5e4, 2e4, 7e4, 9e4,8e4, 8e4 ),
           Days = c(2,5,3,2,3,2, 3, 3, 4, 3)) %>%
  mutate(PersonDays =  Capacity*Days) %>% 
  arrange(Festival)

```

#Sources

##Glasto
https://www.whatdotheyknow.com/request/crime_statistics_from_glastonbur
22-26 June
1449 articles


##Notting Hill
https://www.whatdotheyknow.com/request/notting_hill_carnival_crime

435 articles about 260 unique

##FSTVL lovebox wireless sw4
https://beta.met.police.uk/globalassets/foi-media/disclosure_2017/april_2017/information-rights-unit--quantities-of-crimes-recorded-against-under-each-category-of-victim-based-crime-other-crimes-against-society-and-fraud-offences
FSTVL 28-29 may
Wireless 8-10 jul
SW4 27-28 August


##T in the park
https://www.whatdotheyknow.com/request/388712/response/948315/attach/3/2011%202016%20Crime%20Stats.pdf
7-10 july

#Reading
This data source is not very good they added up the totals incorrectly, however the police claim in an foi they don't have data which is odd becuase the newspaper is quoting them
http://www.readingchronicle.co.uk/news/14720956.Reading_Festival_2016__Crime_rate_down_20_per_cent_on_last_year__new_figures_show/
26-28 August

##Bestival
NOt that gret a data source
http://www.iwcp.co.uk/news/news/police-praise-bestival-despite-rise-in-some-crimes-96145.aspx
8-11 September


```{r}

 CrimeBreakdown=  data_frame('Notting Hill'= c(105,264,170,27,33,41,95), 
                             "Glastonbury" = c(16,154,32,2,0,1,0),
                             "FSTVL" = c(0,51,9,1,5,0,1),
                             "Lovebox" = c(9,33,19,2,0,0,0),
                             "Wireless" = c(14,38,9,3,3,0,0),
                             "SW4" = c(6,50,14,1,2,0,0),
                             "T in the Park" = c(29,95,381,3,1,1,20),
                             "Reading" = c(0,104,30,2,6,0,0),
                             "Bestival" = c(13,146,30,1,0,0,12),
                             "Leeds" = c(12,129, 38,1,3,2,13),
                            Type = c("Violent", "Theft", "Drugs", "Sex", "Robbery", "Weapons", "Other")) %>%
  gather(key = Festival, Crimes,-Type) %>%
  spread(key = Type, value = Crimes) %>%
  mutate(Total = rowSums(.[-1]),
         Exp = rowSums(.[-c(1,2,8)]))%>% 
  arrange(Festival)

 CrimeBreakdownRate <- FestivalData %>% select(Festival, PersonDays) %>%
  left_join(CrimeBreakdown, by = "Festival") %>% 
  mutate_if(is.numeric, funs(FestivalData$PersonDays/.)) %>%
    mutate_if(is.numeric, funs(1/.)) %>%
   select(-PersonDays)

 CrimeBreakdownPP <-  CrimeBreakdownRate%>%
 mutate_if(.,is.numeric, funs(1/.)) 

```

#Ranking Festivals
```{r}

 CrimeBreakdownPP %>% mutate_if(is.numeric, funs(rank(-.))) %>%
  mutate(AverageRank = rowMeans(.[-1]),
         RankAvgRank = rank(AverageRank),
         AverageRank = round(AverageRank))

```

#getting lexis nexis

##Nottinghill

```{r}
setwd("/home/jonno/FestivalAnalysis")
GlastonburyDATA <- ProcessArticles("Glastonbury")
NottingHillDATA <- ProcessArticles("Notting Hill")
WirelessDATA <- ProcessArticles("Wireless")
BestivalDATA <- ProcessArticles("Bestival")
ReadingDATA <- ProcessArticles("Reading")
LeedsDATA <- ProcessArticles("Leeds")
TparkDATA <- ProcessArticles("T in the park")
```


```{r}
Comparefest <- ls(pattern=("DATA")) %>%
  map_df(~eval(parse(text =paste0(.x,"$FestivalSentiment")))) %>%
  spread(key = Festival, value = count) 

PercentFest <- Comparefest  %>% setNames(make.names(names(.))) %>%
  mutate(type = ifelse(sentiment=="positive"| sentiment == "negative", "direction", "emotions")) %>%
  group_by(type) %>%
  mutate_if(is.numeric, funs(./sum(.)))%>% 
  arrange(type)  %>% ungroup

#not very interesting
autoplot(prcomp(PercentFest[,-c(1,9)]), data = PercentFest, colour = "type") 

PercentFest2 <- PercentFest %>% 
  filter(type!="direction") %>%
  filter(sentiment!="trust") %>%
  select(-type) %>%
  gather(key = "Festival", value = "value",-sentiment) %>%
  spread(key=sentiment, value = value)

autoplot(prcomp(PercentFest2[,-c(1)]), data = PercentFest2, colour = "Festival", loadings = TRUE, loadings.label = TRUE) 

RelativetoGlasto <- PercentFest%>%
  mutate_if(is.numeric, funs(./PercentFest$Glastonbury))



theta <- function(a,b){
  acos( sum(a*b) / ( sqrt(sum(a * a)) * sqrt(sum(b * b)) ) )
  }

theta(PercentFest$Glastonbury, PercentFest$NottingHill)
theta(PercentFest$Glastonbury, PercentFest$Wireless)
theta(PercentFest$NottingHill, PercentFest$Wireless)

```

